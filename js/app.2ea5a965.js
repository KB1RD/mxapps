(function(e){function t(t){for(var r,o,i=t[0],c=t[1],u=t[2],p=0,d=[];p<i.length;p++)o=i[p],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&d.push(a[o][0]),a[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);l&&l(t);while(d.length)d.shift()();return s.push.apply(s,u||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],r=!0,i=1;i<n.length;i++){var c=n[i];0!==a[c]&&(r=!1)}r&&(s.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},a={app:0},s=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var u=0;u<i.length;u++)t(i[u]);var l=c;s.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},1006:function(e,t,n){"use strict";var r=n("c8af"),a=n.n(r);a.a},"146f":function(e,t,n){},"3f8e":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("a4d3"),n("e01a"),n("a623"),n("4160"),n("d81d"),n("b64b"),n("d3b7"),n("159b");var r=n("3835"),a=n("2909"),s=n("ade3"),o=(n("96cf"),n("1da1")),i=n("668b"),c=(n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("2b0e")),u=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("router-view",{attrs:{id:"root"}})},l=[],p=(n("5c0b"),n("2877")),d={},f=Object(p["a"])(d,u,l,!1,null,null,null),m=f.exports,h=n("9483");Object(h["a"])("".concat("/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}});var b=n("8c4f"),v=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div")},_=[],g=(n("b0c0"),n("3ca3"),n("ddb0"),n("53ca")),y=n("b85c"),k=n("f6d2"),w={active:!1,failed:!1,channel:void 0,account:void 0},x=[{name:"SharedWorker",func:function(){return Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new SharedWorker("/mx-host-core-worker-sharedworker.min.js").port);case 1:case"end":return e.stop()}}),e)})))()}}];function O(e,t){return new Promise((function(n,r){var a=!1;setTimeout((function(){a||r(new Error("Timed out")),a=!0}),t),e.then((function(e){a||n(e),a=!0}),(function(e){a||r(e),a=!0}))}))}function A(){return j.apply(this,arguments)}function j(){return j=Object(o["a"])(regeneratorRuntime.mark((function e(){var t,n,r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=Object(y["a"])(x),e.prev=1,r=regeneratorRuntime.mark((function e(){var t,r,a,s,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=n.value,r=t.name,a=t.func,s=void 0,e.prev=2,e.next=5,O(a(),3e4);case 5:if(s=e.sent,s){e.next=8;break}throw new Error("Port is `undefined`");case 8:e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](2),console.warn("Failed to start ".concat(r),e.t0);case 13:return e.prev=13,o=new k["RpcChannel"]((function(e,t){return s.postMessage(e,t)})),s.onmessage=function(e){return o.receive(e.data)},e.next=18,O(o.call_obj.net.kb1rd.services.requestServices({id:["net","kb1rd","mxbindings"],versions:[[0,2]]}),1e3);case 18:return e.next=20,O(o.call_obj.net.kb1rd.services.requestServices({id:["net","kb1rd","apps"],versions:[[0,1]]}),1e3);case 20:return w.channel=o,w.active=!0,w.failed=!1,e.abrupt("return",{v:void 0});case 26:throw e.prev=26,e.t1=e["catch"](13),w.failed=!0,e.t1;case 30:case"end":return e.stop()}}),e,null,[[2,10],[13,26]])})),t.s();case 4:if((n=t.n()).done){e.next=11;break}return e.delegateYield(r(),"t0",6);case 6:if(a=e.t0,"object"!==Object(g["a"])(a)){e.next=9;break}return e.abrupt("return",a.v);case 9:e.next=4;break;case 11:e.next=16;break;case 13:e.prev=13,e.t1=e["catch"](1),t.e(e.t1);case 16:return e.prev=16,t.f(),e.finish(16);case 19:console.error("Reached end of available worker types. Setup failed."),w.failed=!0;case 21:case"end":return e.stop()}}),e,null,[[1,13,16,19]])}))),j.apply(this,arguments)}var C={data:function(){return w},watch:{active:function(){if(this.active){var e=this.$route.params.token,t=w.channel.call_obj.net.kb1rd.apps.v0.redeemToken[e]();t.then((function(e){return window.parent.postMessage(["ctx",e,null],"*",[e.port])}),(function(e){var t=Object.assign({},e);window.parent.postMessage(["ctx",null,t],"*")}))}}}},S=C,$=Object(p["a"])(S,v,_,!1,null,null,null),R=$.exports,E=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gradient-container"},[n("SimpleSVG",{attrs:{id:"logo-svg",filepath:"/logo/apps logo.svg",fill:"#fff",stroke:"#fff"}}),n("b-card",{attrs:{id:"signin-dialog",title:"Sign In"}},[e.workerstate.failed?n("b-card-text",[e._v(" Failed to start core. Make sure your browser can support either service or shared workers. ")]):e.workerstate.active?n("router-view"):n("b-card-text",[n("b-spinner",{staticStyle:{width:"3rem",height:"3rem"},attrs:{variant:"primary",label:"Starting core..."}})],1)],1)],1)},I=[],T=n("b047"),q={components:{SimpleSVG:T["SimpleSVG"]},data:function(){return{workerstate:w}}},L=q,N=(n("6ca4"),Object(p["a"])(L,E,I,!1,null,null,null)),M=N.exports,B=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-card-text",[e._v(" Software written by Matrix users like you. Check it out on "),n("a",{attrs:{href:"https://github.com/KB1RD/matrix-notepad"}},[e._v("GitHub")]),e._v(" and come chat on "),n("a",{attrs:{href:"https://matrix.to/#/#matrix-collaboration:kb1rd.net?via=kb1rd.net&via=matrix.org&via=matrix.geklautecloud.de"}},[e._v(" #matrix-collaboration:kb1rd.net. ")]),n("b-list-group",{staticClass:"account-list-group"},e._l(e.accounts,(function(e){return n("AccountOption",{key:e,attrs:{id:e}})})),1),n("b-button",{attrs:{block:"",variant:"outline-primary"},on:{click:e.redirectNewAccount}},[e._v("+ Add an account")])],1)},D=[],P=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-list-group-item",{staticClass:"d-flex align-items-center ellipsis-flex-overflow",attrs:{to:"/login/to/"+e.id}},[e.loaded?[n("b-avatar",{staticClass:"mr-3",attrs:{badge:"","badge-variant":e.state_badge}}),n("span",{staticClass:"mr-auto"},[e._v(e._s(this.astate.display_name))])]:e.loading?[n("b-avatar",{staticClass:"mr-3"}),n("span",{staticClass:"text-loading"})]:e.unauth?[n("b-avatar",{staticClass:"mr-3",attrs:{variant:"warning",text:"?"}}),n("span",{staticClass:"mr-auto"},[e._v("Account is not signed in using Matrix.")])]:e.error?[n("b-avatar",{staticClass:"mr-3",attrs:{variant:"danger"}}),n("span",{staticClass:"mr-auto"},[e._v("Internal error")])]:e._e()],2)},F=[],G={props:{id:String},genbind:{astate:{apply:["id"],address:function(e){return["net","kb1rd","mxbindings","v0",e,"listenUserState"]},default:[]}},data:function(){return{workerstate:w,astate:{state:"LOADING"}}},methods:{redirectSigninAccount:function(){var e=this.$route.query.redirect_to||"/";this.$router.push({path:"/login/new",query:{redirect_to:e}})}},computed:{state_badge:function(){return{ACTIVE:"success",OFFLINE:"warning",INACTIVE:"info",STARTING:"primary"}[this.astate.state]||"secondary"},loaded:function(){return"LOADING"!==this.astate.state&&"ERROR"!==this.astate.state&&"UNAUTHENTICATED"!==this.astate.state},error:function(){return"ERROR"===this.astate.state},loading:function(){return"LOADING"===this.astate.state},unauth:function(){return"UNAUTHENTICATED"===this.astate.state}}},U=G,V=(n("1006"),Object(p["a"])(U,P,F,!1,null,"2cf47346",null)),Y=V.exports,H={components:{AccountOption:Y},genbind:{accounts:{address:["net","kb1rd","accounts","v0","listenAccounts"],default:[]}},methods:{redirectNewAccount:function(){var e=this.$route.query.redirect_to||"/";this.$router.push({path:"/login/new",query:{redirect_to:e}})}}},W=H,J=(n("6294"),Object(p["a"])(W,B,D,!1,null,"dcb218be",null)),X=J.exports,K=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-card-text",[n("b-form",{staticClass:"signin-form",on:{submit:e.onFormSubmit}},[n("b-form-group",{attrs:{"label-for":"mxid-input"}},[n("b-form-input",{attrs:{id:"mxid-input",disabled:e.is_busy,state:e.id_valid&&!e.lookup_error_msg&&void 0,required:"",placeholder:"@name:server.org","aria-describedby":e.lookup_error_msg?"login-mxid-error":""},on:{input:e.onUserIdChange},model:{value:e.form.id,callback:function(t){e.$set(e.form,"id",t)},expression:"form.id"}}),e.lookup_error_msg?n("b-form-invalid-feedback",{attrs:{id:"login-mxid-error"}},[e._v(" "+e._s(e.lookup_error_msg)+" ")]):e._e()],1),n("b-form-group",[n("b-form-checkbox",{attrs:{disabled:e.is_busy},model:{value:e.form.checked,callback:function(t){e.$set(e.form,"checked",t)},expression:"form.checked"}},[e._v(" Infer homeserver URL ")])],1),n("transition",{attrs:{name:"hs-url"}},[e.form.checked?e._e():n("div",{staticClass:"hs-url"},[n("b-form-group",{attrs:{"label-for":"mxid-input"}},[n("b-form-input",{attrs:{id:"mxid-input",required:!e.form.checked,disabled:e.is_busy,placeholder:"https://matrix.server.org"},model:{value:e.form.url,callback:function(t){e.$set(e.form,"url",t)},expression:"form.url"}})],1)],1)]),n("b-alert",{attrs:{show:!e.form.checked&&e.form.url.toLowerCase().startsWith("http:"),variant:"warning"}},[e._v(" Warning: This server address is using insecure HTTP. You should always use HTTPS to connect to your server. HTTP support is for development and testing purposes only. ")]),n("b-button",{attrs:{type:"submit",block:"",variant:"primary",disabled:e.is_busy}},[e.is_busy?n("b-spinner",{attrs:{small:""}}):e._e(),e._v(" "+e._s(e.is_busy?"Loading...":"Next")+" ")],1)],1),n("b-button",{attrs:{block:"",variant:"outline-secondary"},on:{click:e.cancel}},[e._v(" Cancel ")])],1)},z=[],Q=(n("baa5"),n("fb6a"),n("ac1f"),n("2ca0"),{data:function(){return{form:{id:"",checked:!0,url:""},infer_hs:!0,is_busy:!1,not_cancelled:!0,lookup_error_msg:void 0}},computed:{id_valid:function(){var e=/^[@][^@:]*:[^@:]*(:[0-9]+)?$/gm.exec(this.form.id);return this.form.id.length?e&&0===e.index||!1:void 0}},watch:{form:{deep:!0,handler:function(){this.lookup_error_msg=void 0}}},methods:{cancel:function(){this.not_cancelled=!1;var e=this.$route.query.redirect_to||"/";this.$router.push({path:"/login/",query:{redirect_to:e}})},redirectPassAuth:function(e,t){var n=this.$route.query.redirect_to||"/";this.$router.push({path:"/login/pass",query:{redirect_to:n,mxid:e,hs:t}})},onUserIdChange:function(){if(this.form.id.length){while(this.form.id.lastIndexOf("@")>0)this.form.id=this.form.id.slice(0,this.form.id.lastIndexOf("@"))+":"+this.form.id.slice(this.form.id.lastIndexOf("@")+1,this.form.id.length);this.form.id.startsWith("@")||(this.form.id="@"+this.form.id)}},onFormSubmit:function(e){if(e.preventDefault(),this.id_valid){var t=w.channel.call_obj.net.kb1rd.mxbindings,n=this.form,r=n.id,a=n.url,s=n.checked,i=this;Object(o["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=a,!s){e.next=16;break}return i.is_busy=!0,e.prev=3,e.next=6,t.v0.getHsUrl[r]();case 6:n=e.sent,i.is_busy=!1,e.next=16;break;case 10:return e.prev=10,e.t0=e["catch"](3),i.is_busy=!1,console.error("Failed to run .well-known discovery",e.t0),i.lookup_error_msg="Failed to auto-discover homeserver URL",e.abrupt("return");case 16:i.not_cancelled&&i.redirectPassAuth(r,n);case 17:case"end":return e.stop()}}),e,null,[[3,10]])})))()}}}}),Z=Q,ee=(n("7d77"),Object(p["a"])(Z,K,z,!1,null,"75da6f25",null)),te=ee.exports,ne=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-card-text",[n("b-form",{staticClass:"signin-form",on:{submit:e.onFormSubmit}},[n("b-form-group",{attrs:{"label-for":"mxid-input"}},[n("b-form-input",{attrs:{value:e.id,disabled:!0,"aria-describedby":"login-hs-via-info"}}),n("b-form-text",{attrs:{id:"login-hs-via-info"}},[e._v("Via "+e._s(e.hs))])],1),n("b-form-group",{attrs:{"label-for":"pass-input"}},[n("b-form-input",{attrs:{id:"pass-input",disabled:e.is_busy,type:"password",required:"",placeholder:"Password",state:!e.error_msg&&void 0,"aria-describedby":e.error_msg?"login-password-error":""},model:{value:e.pass,callback:function(t){e.pass=t},expression:"pass"}}),e.error_msg?n("b-form-invalid-feedback",{attrs:{id:"login-password-error"}},[e._v(" "+e._s(e.error_msg)+" ")]):e._e()],1),n("b-button",{attrs:{type:"submit",block:"",variant:"primary",disabled:e.is_busy}},[e.is_busy?n("b-spinner",{attrs:{small:""}}):e._e(),e._v(" "+e._s(e.is_busy?"Signing In...":"Sign In")+" ")],1)],1),n("b-button",{attrs:{block:"",variant:"outline-secondary"},on:{click:e.cancel}},[e._v(" Cancel ")])],1)},re=[],ae=(n("5319"),{data:function(){return{pass:"",is_busy:!1,error_msg:void 0,not_cancelled:!0}},watch:{pass:function(){this.error_msg=void 0}},computed:{id:function(){var e;return(null===(e=this.$route.query)||void 0===e?void 0:e.mxid)||""},hs:function(){var e;return(null===(e=this.$route.query)||void 0===e?void 0:e.hs)||""}},methods:{cancel:function(){this.not_cancelled=!1;var e=this.$route.query.redirect_to||"/";this.$router.push({path:"/login/",query:{redirect_to:e}})},redirectLoginTo:function(e){var t=this.$route.query.redirect_to||"/";this.$router.replace({path:"/login/to/".concat(e),query:{redirect_to:t}})},onFormSubmit:function(e){e.preventDefault();var t=w.channel.call_obj.net.kb1rd.mxbindings,n=this.pass,r=this;Object(o["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r.is_busy=!0,e.prev=1,e.next=4,t.v0.fromPass[r.id](n,r.hs);case 4:a=e.sent,r.is_busy=!0,r.not_cancelled&&r.redirectLoginTo(a),e.next=21;break;case 9:e.prev=9,e.t0=e["catch"](1),e.t1=e.t0.name,e.next="M_FORBIDDEN"===e.t1?14:17;break;case 14:return r.error_msg="Invalid username or password",console.error("Password invalid"),e.abrupt("break",20);case 17:return r.error_msg="Unknown error signing in",console.error("Unknown error",e.t0),e.abrupt("break",20);case 20:r.is_busy=!1;case 21:case"end":return e.stop()}}),e,null,[[1,9]])})))()}}}),se=ae,oe=(n("f0d6"),Object(p["a"])(se,ne,re,!1,null,"7907cf19",null)),ie=oe.exports,ce=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-card-text",[e.failed?e._e():n("b-spinner",{staticStyle:{width:"3rem",height:"3rem",margin:"10px 0px"},attrs:{variant:"primary",label:"Starting core..."}}),e.failed?n("p",[e._v(" Failed to sign in. Is your server online and is your internet working? ")]):e._e(),n("b-button",{attrs:{block:"",variant:"outline-secondary"},on:{click:e.cancel}},[e._v("Cancel")])],1)},ue=[],le={methods:{cancel:function(){this.not_cancelled=!1;var e=this.$route.query.redirect_to||"/";this.$router.replace({path:"/login/",query:{redirect_to:e}})},onDone:function(){var e=this.$route.query.redirect_to||"/";this.$router.replace({path:e,query:{account:this.$route.params.id}})}},data:function(){return{failed:!1,not_cancelled:!0}},mounted:function(){var e=w.channel.call_obj.net.kb1rd.mxbindings,t=this.$route.params.id,n=this;Object(o["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,e.v0[t].start();case 3:n.onDone(),r.next=10;break;case 6:r.prev=6,r.t0=r["catch"](0),n.failed=!0,console.error("Failed to sign in",r.t0);case 10:case"end":return r.stop()}}),r,null,[[0,6]])})))()}},pe=le,de=Object(p["a"])(pe,ce,ue,!1,null,null,null),fe=de.exports,me=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{display:"flex","flex-direction":"row","justify-content":"center"}},[n("b-card",{staticClass:"room-list",attrs:{"no-body":""},scopedSlots:e._u([{key:"header",fn:function(){return[n("div",{staticClass:"d-flex align-items-center justify-content-between"},[n("span",[e._v("Room List")])])]},proxy:!0}])},[n("b-list-group",{attrs:{flush:""}},e._l(e.rooms,(function(t){return n("b-list-group-item",{key:t.id,staticClass:"d-flex align-items-center",attrs:{href:"#"},on:{click:function(n){return e.openRoomInfer(t.id,t.type)}}},[n("b-overlay",{attrs:{"no-wrap":"",variant:"white","spinner-variant":"primary",show:e.ids_busy.includes(t.id)}}),n("b-avatar",{staticClass:"mr-3",attrs:{variant:"dark",src:t.avatar_url}}),n("div",{staticClass:"d-flex flex-column justify-content-start",staticStyle:{"flex-grow":"1"}},[n("span",{staticClass:"mr-auto"},[e._v(e._s(t.name))]),n("small",{staticClass:"text-muted"},[e._v(" "+e._s(t.id)+" - "+e._s(t.type||"Untyped")+" ")])]),n("b-dropdown",{attrs:{right:"","no-caret":"",variant:"outline-primary"},scopedSlots:e._u([{key:"button-content",fn:function(){return[n("BIconThreeDots")]},proxy:!0}],null,!0)},[n("b-dropdown-item",{on:{click:function(n){n.stopPropagation(),e.room_open_with=t.id}}},[e._v(" Open with... ")])],1)],1)})),1)],1),n("b-modal",{attrs:{scrollable:"","hide-footer":"",title:"Open With",visible:Boolean(e.room_open_with)},on:{hide:function(t){e.room_open_with=void 0}}},[n("ClickableAppListGroup",{attrs:{flush:"",account:e.id},on:{appclick:function(t){return e.openRoom(e.room_open_with,t)}},scopedSlots:e._u([{key:"noapps-text",fn:function(){return[e._v(' You have no apps. To add one, click on the dropdown in the upper right corner and press "Manage Apps." ')]},proxy:!0}])})],1)],1)},he=[],be=(n("99af"),n("c975"),n("a434"),n("7386")),ve=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.apps.length?e._e():n("p",{staticClass:"text-muted"},[e._t("noapps-text",[e._v(' You have no apps. Enter the URL above and click "Add" to get started. ')])],2),n("b-list-group",{staticClass:"account-list-group",attrs:{flush:e.flush}},e._l(e.apps,(function(t){return n("AppListItem",{key:t,attrs:{id:t,account:e.account},on:{appclick:function(n){return e.$emit("appclick",t)}}})})),1)],1)},_e=[],ge=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-list-group-item",{staticClass:"d-flex align-items-center ellipsis-flex-overflow",attrs:{href:"#"},on:{click:function(t){return e.$emit("appclick",e.id)}}},["LOADING"===e.app?[n("b-spinner",{staticStyle:{width:"1rem",height:"1rem"},attrs:{variant:"primary",label:"Loading..."}})]:[n("b-avatar",{staticClass:"mr-3"},[n("BIconBox")],1),n("div",{staticClass:"d-flex flex-column",staticStyle:{"flex-grow":"1"}},[n("span",{staticClass:"font-weight-bold"},[e._v(e._s(e.app.title))]),n("small",{staticClass:"text-muted"},[n("b-badge",{attrs:{variant:"primary"}},[e._v(" v"+e._s(e.app.version[0])+"."+e._s(e.app.version[1])+"."+e._s(e.app.version[2])+" ")]),e._v(" "+e._s(e.id)+" ")],1),e.app.description?n("span",{staticClass:"text-muted"},[e._v(" "+e._s(e.app.description)+" ")]):e._e()])]],2)},ye=[],ke={components:{BIconBox:be["b"]},props:{account:String,id:String},genbind:{app:{apply:["account","id"],address:function(e,t){return["net","kb1rd","apps","v0",e,"userapp",t,"listen"]},default:"LOADING"}}},we=ke,xe=Object(p["a"])(we,ge,ye,!1,null,null,null),Oe=xe.exports,Ae={components:{AppListItem:Oe},props:{account:String,flush:Boolean},genbind:{apps:{apply:["account"],address:function(e){return["net","kb1rd","apps","v0",e,"userapp","listen"]},default:[]}}},je=Ae,Ce=Object(p["a"])(je,ve,_e,!1,null,null,null),Se=Ce.exports,$e={components:{ClickableAppListGroup:Se,BIconThreeDots:be["s"]},genbind:{rooms:{apply:["id"],address:function(e){return["net","kb1rd","mxbindings","v0",e,"listenRoomList"]},default:[]}},data:function(){return{console:console,room_open_with:void 0,ids_busy:[]}},computed:{id:function(){return this.$route.query.account}},methods:{openRoom:function(e,t){var n=this;console.log("Opening ".concat(e," with ").concat(t));var r=this,a=Object(o["a"])(regeneratorRuntime.mark((function n(){var a,s,o,i,c,u;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,w.channel.call_obj.net.kb1rd.apps.v0[r.id].userapp[t].manifest.listen();case 2:if(a=n.sent,s=a.entry_points["net.kb1rd.openroom"],s){n.next=6;break}throw new TypeError("App does not have openroom entry");case 6:return n.next=8,w.channel.call_obj.net.kb1rd.apps.v0[r.id].userapp[t].entry["net.kb1rd.openroom"].setup({room_id:e});case 8:o=n.sent,i=o.token,c=r.$router.resolve("/_linkback/".concat(i)).href,u=s.to.replace("{{return}}",encodeURIComponent(window.location.origin+window.location.pathname+c)),window.open(u,"_blank");case 13:case"end":return n.stop()}}),n)})))();this.ids_busy.push(e),a.then((function(e){}),(function(e){n.$bvModal.msgBoxOk("An unknown error occured while trying to open the app.",{title:"Cannot open app",okVariant:"danger",centered:!0}),console.error("Failed to open app",e)})).then((function(){return n.ids_busy.splice(n.ids_busy.indexOf(e),1)}))},openRoomInfer:function(e,t){var n,r=this;n=t?w.channel.call_obj.net.kb1rd.apps.v0[this.id].assoc[t].listen():Promise.resolve(void 0),this.ids_busy.push(e),n.then((function(n){n?r.openRoom(e,n.to):(r.$bvModal.msgBoxOk('You have no app associated with this room type. Add one by pressing "Manage Apps" under the dropdown in the upper left corner next to your avatar.',{title:"Cannot open app",okVariant:"warning",centered:!0}),console.warn("No app associated with type ".concat(t)))}),(function(e){r.$bvModal.msgBoxOk("An error occured trying to find this room type association.",{title:"Cannot open app",okVariant:"danger",centered:!0}),console.error("Failed to get assocaition",e)})).then((function(){return r.ids_busy.splice(r.ids_busy.indexOf(e),1)}))}}},Re=$e,Ee=(n("6ce0"),Object(p["a"])(Re,me,he,!1,null,"02468742",null)),Ie=Ee.exports,Te=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.show_loading?n("div",{staticClass:"fullscreen-spinner-overlay"},[n("b-spinner",{staticStyle:{width:"3rem",height:"3rem"},attrs:{variant:"primary",label:"Starting core..."}})],1):e._e(),e.show_loading?e._e():n("div",[n("b-navbar",{attrs:{toggleable:"lg",type:"dark",variant:"dark",sticky:!0}},[n("b-navbar-brand",{attrs:{href:"#"}},[n("SimpleSVG",{staticStyle:{height:"50px","margin-top":"-65px"},attrs:{id:"logo-svg",filepath:"/logo/notepad logo.svg",fill:"#fff",stroke:"#fff",height:"50px"}})],1),n("b-navbar-toggle",{attrs:{target:"nav-collapse"}}),n("b-collapse",{attrs:{id:"nav-collapse","is-nav":""}},[n("b-navbar-nav",{staticClass:"ml-auto"},[n("b-nav-item-dropdown",{attrs:{right:""},scopedSlots:e._u([{key:"button-content",fn:function(){return[n("b-avatar",{staticClass:"mr-3",attrs:{badge:"","badge-variant":e.state_badge}}),n("span",[e._v(e._s(e.state.display_name))])]},proxy:!0}],null,!1,1152806273)},[n("b-dropdown-item",{on:{click:function(t){e.modalShow=!e.modalShow}}},[e._v(" Manage Apps ")]),n("b-dropdown-item",{attrs:{to:"/login"}},[e._v(" Switch Users ")])],1)],1)],1)],1),n("AppListModal",{attrs:{account:e.id},model:{value:e.modalShow,callback:function(t){e.modalShow=t},expression:"modalShow"}}),n("router-view")],1)])},qe=[],Le=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("b-modal",{attrs:{title:"My Apps",scrollable:"","hide-footer":"",visible:e.value},on:{change:function(t){return e.$emit("input",t)}}},[n("b-form",{staticClass:"my-2 d-flex flex-row",attrs:{inline:""},on:{submit:function(t){t.preventDefault(),e.open_manifest=e.tmp_url.trim()}}},[n("b-input-group",{staticClass:"mb-2 mr-sm-2 mb-sm-0",staticStyle:{"flex-grow":"1"}},[n("b-input",{attrs:{required:"",placeholder:"App URL"},model:{value:e.tmp_url,callback:function(t){e.tmp_url=t},expression:"tmp_url"}})],1),n("b-button",{attrs:{type:"submit",variant:"primary"}},[e._v("+ Add")])],1),n("h2",{staticClass:"text-muted mt-3"},[e._v("Apps")]),n("ClickableAppListGroup",{attrs:{account:e.account}}),Object.keys(e.associations).length?n("h2",{staticClass:"text-muted mt-3"},[e._v("Associations")]):e._e(),n("b-list-group",{staticClass:"account-list-group"},e._l(Object.keys(e.associations),(function(t){return n("AssociationItem",{key:t,attrs:{id:t,account:e.account,assoc:e.associations[t]}})})),1)],1),e.open_manifest?n("AppAddModal",{attrs:{url:e.open_manifest,account:e.account},on:{exit:function(t){e.open_manifest=null}}}):e._e()],1)},Ne=[],Me=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-list-group-item",{staticClass:"d-flex flex-column justify-items-center ellipsis-flex-overflow"},[n("b",[e._v(e._s(e.id))]),"LOADING"===e.app?n("b-spinner",{staticStyle:{width:"1rem",height:"1rem"},attrs:{variant:"primary",label:"Loading..."}}):n("div",{staticClass:"d-flex flex-row align-items-center ml-2 mt-2"},[n("b-avatar",{staticClass:"mr-3"},[n("BIconBox")],1),n("small",[e._v(e._s(e.app.title))]),n("b-button",{staticClass:"ml-auto circle-btn",attrs:{pill:"",variant:"outline-danger",disabled:e.busy},on:{click:e.clear}},[e.busy?n("b-spinner",{attrs:{small:""}}):n("BIconX")],1)],1)],1)},Be=[],De={components:{BIconBox:be["b"],BIconX:be["t"]},props:{account:String,id:String,assoc:Object},genbind:{app:{apply:["account","assoc"],address:function(e,t){return["net","kb1rd","apps","v0",e,"userapp",t.to,"listen"]},default:"LOADING"}},data:function(){return{busy:!1}},methods:{clear:function(){var e=this,t=w.channel.call_obj.net.kb1rd.apps.v0[this.account].assoc[this.id].set(void 0);this.busy=!0,t.then((function(){e.$bvModal.msgBoxOk("The association was removed.",{title:"Association Removed",okVariant:"success",centered:!0})}),(function(t){e.$bvModal.msgBoxOk("An error occured while trying to remove the assocation.",{title:"Error",okVariant:"danger",centered:!0}),console.error("Failed remove association",t)})).then((function(){return e.busy=!1}))}}},Pe=De,Fe=Object(p["a"])(Pe,Me,Be,!1,null,null,null),Ge=Fe.exports,Ue=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-modal",{attrs:{title:"Add an App",scrollable:"",visible:!0,"ok-title":"Add","ok-disabled":Boolean(e.error||!e.response),busy:e.busy},on:{change:function(t){return!1===t?e.$emit("exit"):void 0},ok:e.addApp}},[e.error?[e._v(" Failed to load app information. Double-check that you have the app's URL correct and try again. ")]:e.response?[n("h1",[e._v(e._s(e.title))]),n("p",{staticClass:"text-muted"},[n("b-badge",{attrs:{variant:"primary"}},[e._v(" v"+e._s(e.response.manifest.version[0])+" ."+e._s(e.response.manifest.version[1])+" ."+e._s(e.response.manifest.version[2])+" ")]),e._v(" "+e._s(e.url)+" ")],1),n("h2",{staticClass:"text-muted"},[e._v("Permissions")]),n("b-list-group",[e._l(e.known_permissions,(function(t,r){var a=t.name,s=t.enabled_by;return n("b-list-group-item",{key:a,staticClass:"d-flex flex-column justify-items-center"},[n("b-form-checkbox",{attrs:{disabled:e.permissions_disabled[r],switch:""},model:{value:e.permission_values[r],callback:function(t){e.$set(e.permission_values,r,t)},expression:"permission_values[i]"}},[e._v(" "+e._s(e.$t("permissions/title/"+a))+" ")]),n("span",{staticClass:"text-muted font-small"},[e._v(" "+e._s(e.$t("permissions/desc/"+a))+" ")]),e.permissions_disabled[r]?n("small",{staticClass:"text-muted"},[e._v(" Required to "),n("em",[e._v(e._s(s.filter((function(t){return e.permission_values[t]})).map((function(t){return e.known_permissions[t].name})).map((function(t){return e.$t("permissions/title/"+t)})).join(", ")))])]):e._e()],1)})),e._l(e.response.unknown_permissions,(function(t,r){return n("b-list-group-item",{key:t,staticClass:"d-flex flex-column justify-items-center",attrs:{variant:"warning"}},[n("b-form-checkbox",{attrs:{switch:""},model:{value:e.unknown_permission_values[r],callback:function(t){e.$set(e.unknown_permission_values,r,t)},expression:"unknown_permission_values[i]"}},[e._v(" "+e._s(e.$t("permissions/unknown"))+" '"+e._s(t)+"' ")]),n("span",{staticClass:"text-muted font-small"},[e._v(" "+e._s(e.$t("permissions/unknown-desc"))+" ")])],1)}))],2),e.response.manifest.entry_points["net.kb1rd.openroom"]?[n("h2",{staticClass:"text-muted mt-3"},[e._v("Associations")]),e._l(e.response.manifest.entry_points["net.kb1rd.openroom"].types,(function(t){return n("b-form-checkbox",{key:t,attrs:{value:t,name:"flavour-3a"},model:{value:e.associations,callback:function(t){e.associations=t},expression:"associations"}},[e._v(" "+e._s(e.$t("associations/associatewith.{TYPE}").replace("{TYPE}",t))+" ")])}))]:e._e()]:[n("b-spinner",{staticStyle:{width:"3rem",height:"3rem"},attrs:{variant:"primary",label:"Downloading app manifest..."}})]],2)},Ve=[],Ye=(n("45fc"),{props:{url:String,account:String},data:function(){return{busy:!1,error:!1,response:void 0,known_permissions:[],permissions_disabled:[],permission_values:[],unknown_permission_values:[],associations:[]}},methods:{addApp:function(e){var t=this;e.preventDefault();var n={};this.known_permissions.forEach((function(e,r){n[e.name]=t.permission_values[r]})),this.response.unknown_permissions.forEach((function(e,r){n[e]=t.unknown_permission_values[r]}));var r=this,a=Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,w.channel.call_obj.net.kb1rd.apps.v0[r.account].userapp[r.url].setup(r.response.manifest);case 2:return e.next=4,w.channel.call_obj.net.kb1rd.apps.v0[r.account].userapp[r.url].perms.set(n);case 4:return e.next=6,Promise.all(r.associations.map((function(e){return w.channel.call_obj.net.kb1rd.apps.v0[r.account].assoc[e].set(r.url)})));case 6:case"end":return e.stop()}}),e)})))();this.busy=!0,a.then((function(){t.$bvModal.msgBoxOk("Added '".concat(t.title,"' to your account"),{title:"Added App",okVariant:"success",centered:!0}).then((function(){return t.$emit("exit")}))}),(function(e){t.$bvModal.msgBoxOk("An error occurred while trying to add '".concat(t.title,"' to your ")+"account.",{title:"Failed to add app",okVariant:"danger",centered:!0}),console.error("Failed to add app",e)})).then((function(){return t.busy=!1}))}},computed:{title:function(){if(this.response){var e=this.response.manifest.title;return e["en-US"]||e.en||e[Object.keys(e)[0]]}}},watch:{permission_values:function(){var e=this;this.permission_values.forEach((function(t,n){var r=e.known_permissions[n].enabled_by.some((function(t){return e.permission_values[t]}));r&&!t&&e.permission_values.splice(n,1,!0),e.permissions_disabled.splice(n,1,r)}))}},mounted:function(){var e=this,t=w.channel.call_obj.net.kb1rd.apps.v0.app[this.url].fetchAndVerifyManifest();t.then((function(t){var n,r,s,o;e.response=t;var i=t.known_permissions,c=Object.keys(i);c.forEach((function(e){i[e].enabled_by||(i[e].enabled_by=[])})),c.forEach((function(e){i[e].inherits.forEach((function(t){i[t].enabled_by.push(e)}))})),(n=e.known_permissions).push.apply(n,Object(a["a"])(c.map((function(e){return{name:e,enabled_by:i[e].enabled_by.map((function(e){return c.indexOf(e)}))}})))),(r=e.permission_values).push.apply(r,Object(a["a"])(c.map((function(){return!1})))),(s=e.permissions_disabled).push.apply(s,Object(a["a"])(e.permission_values)),(o=e.unknown_permission_values).push.apply(o,Object(a["a"])(t.unknown_permissions.map((function(){return!1}))))}),(function(t){e.error=t,console.warn("Failed to load app manifest",t)}))}}),He=Ye,We=Object(p["a"])(He,Ue,Ve,!1,null,null,null),Je=We.exports,Xe={components:{ClickableAppListGroup:Se,AssociationItem:Ge,AppAddModal:Je},props:{account:String,value:Boolean},genbind:{associations:{apply:["account"],address:function(e){return["net","kb1rd","apps","v0",e,"assoc","listen"]},default:{}}},data:function(){return{tmp_url:"",open_manifest:""}}},Ke=Xe,ze=Object(p["a"])(Ke,Le,Ne,!1,null,null,null),Qe=ze.exports,Ze={components:{SimpleSVG:T["SimpleSVG"],AppListModal:Qe},genbind:{state:{apply:["id"],address:function(e){return["net","kb1rd","mxbindings","v0",e,"listenUserState"]},default:{state:"LOADING"},error:{state:"ERROR"}}},data:function(){return{modalShow:!1}},computed:{id:function(){return this.$route.query.account},show_loading:function(){return"LOADING"===this.state.state||"STARTING"===this.state.state},state_badge:function(){return{ACTIVE:"success",OFFLINE:"warning",INACTIVE:"info",STARTING:"primary"}[this.state.state]||"secondary"}},watch:{state:function(){if("ERROR"===this.state.state||"UNAUTHENTICATED"===this.state.state||"INACTIVE"===this.state.state){var e=this.$route.path;this.$router.replace({path:"/login",query:{redirect_to:e}})}}}},et=Ze,tt=(n("a116"),Object(p["a"])(et,Te,qe,!1,null,"8fe97df0",null)),nt=tt.exports;c["default"].use(b["a"]);var rt=[{path:"/_linkback/:token",component:R},{path:"/",component:nt,beforeEnter:function(e,t,n){if(!w.channel)return n({path:"/login",query:{redirect_to:e.path}});t.query.account&&!e.query.account?(e.query.account=t.query.account,n(e)):n()},children:[{path:"",component:Ie}]},{path:"/login",component:M,children:[{path:"",component:X},{path:"new",component:te},{path:"pass",component:ie},{path:"to/:id",component:fe}]}],at=new b["a"]({routes:rt}),st=at,ot=n("a925"),it=n("e088"),ct="en",ut={en:it},lt=n("5f5b");c["default"].config.productionTip=!1,c["default"].use(ot["a"]),c["default"].use(lt["a"]);var pt=Symbol("ActiveRpcGenerators");c["default"].mixin({data:function(){var e={},t=this.$options.genbind;return t&&Object.keys(t).forEach((function(n){return e[n]=t[n].default})),e},methods:{$bind_generate:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:r;this[pt]||(this[pt]={}),this[pt][e]&&this[pt][e].shutdown(),this[e]=r;var c=w.channel.generate(t.map((function(e){return"".concat(e)})),n);this[pt][e]={instance:c,address:t,default:r,shutdown:function(){return c.return(r)}};var u=this;Object(o["a"])(regeneratorRuntime.mark((function t(){var n,r,o,l,p,d,f;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:t.prev=0,n=!0,r=!1,t.prev=3,l=Object(i["a"])(c);case 5:return t.next=7,l.next();case 7:return p=t.sent,n=p.done,t.next=11,p.value;case 11:if(d=t.sent,n){t.next=18;break}f=d,Object.assign(u,Object(s["a"])({},e,f));case 15:n=!0,t.next=5;break;case 18:t.next=24;break;case 20:t.prev=20,t.t0=t["catch"](3),r=!0,o=t.t0;case 24:if(t.prev=24,t.prev=25,n||null==l.return){t.next=29;break}return t.next=29,l.return();case 29:if(t.prev=29,!r){t.next=32;break}throw o;case 32:return t.finish(29);case 33:return t.finish(24);case 34:t.next=40;break;case 36:t.prev=36,t.t1=t["catch"](0),console.warn("Caught error populating component RPC data",t.t1),Object.assign(u,Object(s["a"])({},e,a));case 40:case"end":return t.stop()}}),t,null,[[0,36],[3,20,24,34],[25,,29,33]])})))()}},created:function(){var e=this,t=this.$options.genbind;if(t){var n=function(t,n,r){var s;s="function"===typeof r.address?r.address.apply(r,Object(a["a"])((r.apply||[]).map((function(e){return t[e]})))):r.address;var o=function(e,t){return e.length===t.length&&e.every((function(e,n){return t[n]===e}))},i=t[pt]&&t[pt][n];i&&o(i.address,s)||e.$bind_generate(n,s,[],r.default,r.error||r.default)};Object.keys(t).map((function(e){return[e,t[e]]})).forEach((function(t){var a=Object(r["a"])(t,2),s=a[0],o=a[1];o.apply&&o.apply.length&&o.apply.forEach((function(t){e.$watch(t,(function(){return n(e,s,o)}))})),n(e,s,o)}))}},beforeDestroy:function(){var e=this[pt];e&&Object.keys(e).forEach((function(t){return e[t].shutdown()}))}});var dt=new ot["a"]({locale:ct,messages:Object.assign(ut)});new c["default"]({i18n:dt,router:st,render:function(e){return e(m)}}).$mount("#app"),A().then((function(){console.log("Worker setup complete"),window.$channel=w.channel}))},"5c0b":function(e,t,n){"use strict";var r=n("9c0c"),a=n.n(r);a.a},6294:function(e,t,n){"use strict";var r=n("a32e"),a=n.n(r);a.a},"6ca4":function(e,t,n){"use strict";var r=n("c695"),a=n.n(r);a.a},"6ce0":function(e,t,n){"use strict";var r=n("3f8e"),a=n.n(r);a.a},"7d77":function(e,t,n){"use strict";var r=n("8376"),a=n.n(r);a.a},8376:function(e,t,n){},"8d9e":function(e,t,n){},"9c0c":function(e,t,n){},a116:function(e,t,n){"use strict";var r=n("146f"),a=n.n(r);a.a},a32e:function(e,t,n){},c695:function(e,t,n){},c8af:function(e,t,n){},e088:function(e){e.exports=JSON.parse('{"permissions/unknown":"Unknown permission","permissions/unknown-desc":"mxapps doesn\'t know about this permission. This app may require a newer or modified version of mxapps. If you enable it, it may work on other clients, but will do nothing on this one.","permissions/title/a.openroom.state.get":"Read room state","permissions/desc/a.openroom.state.get":"Allows the application to read state in rooms that you open with it, except for membership, power level, invite, and server ACL state.","permissions/title/a.openroom.state.set":"Write to room state","permissions/desc/a.openroom.state.set":"Allows the application to write to state in rooms that you open with it, except for join rule, membership, power level, history visibility, invite, guest access, server ACL, and upgrade state.","associations/associatewith.{TYPE}":"Associate with \'{TYPE}\' files"}')},f0d6:function(e,t,n){"use strict";var r=n("8d9e"),a=n.n(r);a.a}});
//# sourceMappingURL=app.2ea5a965.js.map